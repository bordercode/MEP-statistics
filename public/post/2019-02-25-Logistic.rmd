---
title: "Logistic"
author: "JLMR"
date: 2019-02-28T21:14:14-05:00
categories: ["R"]
tags: ["Logistic", "log(odds)", "glm"]
mathjax : true
menu:
  main:
    name: Logistic R
    weight: 15
---


```{r set-global-options, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(eval = TRUE, 
                      echo = TRUE, 
                      cache = FALSE,
                      include = TRUE,
                      collapse = FALSE,
                      dependson = NULL,
                      engine = "R", # Chunks will always have R code, unless noted
                      error = FALSE)   


```



```{r silent-packages, echo = FALSE, eval = TRUE, message=FALSE, include = FALSE}
library(tidyverse)
library(ISLR)
library(foreign)
library(scales)
```



### Por qué el modelo de Regresión Logística?

En los casos anteriores hemos considerado que nuestros datos son númericos (variables contínuas o discretas pero de naturaleza cuantitativa).

Para el caso del **modelo de regresión logistica** nos interesa hacer predicciones para  variables **categóricas**.  

Reponder preguntas como: Cuál es la probabilidad de que un individuo partenezca a la categoría **i**? dado un conjunto de características ($x_i, ...,x_n$).

Ejemplo  1. Dado un conjunto de textos de Twitter, determinar cuales pertenecen a un sentimiento positivo y cuáles a un sentimiento negativo.

Ejemplo 2. Dadas las características de la madre, como edad, sexo, semanas de gestación, procedimiento cesárea o no, peso y talla del bebé determinar la probabilidad de que el bebé presente el padecimiento x. 


El modelo de regressión logística nos permite **clasificar**. Predecir una respuesta cualitativa ej. asignar a una categoria determinada las observaciones en un conjunto de datos se puede realizar mediante el modelo  de regressión logística.

El proceso de clasificación implica determinar la **probabilidad** de que la observación *i* pretenezca a una determinada categoría. Lo que se puede lograr a partir del modelo de regresión logística.

**Escenario 1**

Dado el nivel de ingreso (variable *income*) y el saldo de la targeta de crédito (variable *balance*) en una muestra de 10,000 individuos incluidos estudiantes, ¿Cuál es la probabilidad de que un individuo de la muestra, incumpla el pago de su deuda? (*Default*). 

El primer paso para aproximar la solución de este problema de clasificación es representar las variables de interés. 

Note que la variable dependiente (**Y**) es *Default* y las explicativas (**x_1,...,X_n**) son *income* y *balance*.

**Scatter plot** entre las variables independientes (income y balance) para observar su interacción. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
d<-Default
str(d)
names(d)

p<-ggplot(d,aes(balance, income, colour=default, shape=default))+
  geom_point()+
  theme_light()+
  scale_shape_manual(values=c(1,3))+
  scale_colour_manual(values = c("orange", "darkgreen"))+
  scale_x_continuous(labels = dollar_format())+
  scale_y_continuous(labels = dollar_format())

p
```

Distribución de los datos con un **Boxplot**.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(gridExtra)

bxp1<-ggplot(d,aes(default, balance))+
  geom_boxplot(aes(fill=default))+
  theme_light()+
  scale_y_continuous(labels = dollar_format())+
  scale_fill_manual(values = c("orange", "darkgreen"))+
  theme(legend.position = "none")


bxp2<-ggplot(d,aes(default, income))+
  geom_boxplot(aes(fill=default))+
  theme_light()+
  scale_y_continuous(labels = dollar_format())+
  scale_fill_manual(values = c("orange", "darkgreen"))+
  theme(legend.position = "none")



5/8
grid.arrange(bxp1, bxp2, nrow = 1)

```


Note la relación positiva entre las variables saldo e incumplimiento. Así mismo relación inversa respecto al ingreso, aparentemente aquellos individuos de menor ingreso tiene mayor problema de incumplimiento. 


##### Preeliminares. Contraste de regresión logística respecto a regresión linear con OLS. 



**Escenario 2**

Suponga que tenemos una situación en la que debemos clasificar el padecimiento de un  paciente que llega a la sala de emergencias de un hospital en las categorias: sobredosis o paro cardiáco

\begin{equation}
  Y=\left\{
  \begin{array}{@{}ll@{}}
    0, & \text{si}\ paro cardiáco \\
    1, & \text{sobredosis}
  \end{array}\right.
\end{equation} 


En este caso particular **binario** podríamos estimar un modelo **RL** con **MCO**  y considerar sobredosis si $\hat {Y}>.5 $ 

Sin embargo, nuestros estimados de **MCO** no necesariamente se ubicarian en el intervalo [0,1] de hecho es psible probar que es posible predecir $p(x)<0$ para algunos valores de x así como $p(x)>1$ para otros valores. Por lo tanto su interpretación como probabilidades no tiene sentido.

Aún más, el enfoque de **MCO** para variables cualitativas en un caso no binario, ej. 3 o 4 categorías, carece de sentido totalmente, ya que lo que importa es el significado de cada categoría pero su orden no tiene mayor implicación cuando estimamos el modelo de regresión logística.

Mientras que al cambiar el orden de la variable dependiente en el modelo lineal generariamos resultados diferentes y predicciones inconsistentes. 



#### Modelo de Regressión logística.

Este enfoque está diseñado explicitamente para tratar con variables categóricas (factores en el lenguaje de R, Python, etc,.). 

En este caso podemos estimar la probabilidad de que  **Y** pertenzca a una categoría particular.


Antes de avanzar veamos un par de conceptos preeliminares. Momios y ratio de Momios. 


Qué son los **Momios** (chances de que algo ocurra el ratio o cociente)(**odds**)?  Suponga que tenemos un escenario en el que un equipo participa en 5 partidos.  Gana uno y pierde 4 en este caso podemos calcular los **Odds** de ganar como el cociente:$$1/4=.25$$

En palabras tenemos un chance de ganar (odds) de 0.25.  

**Note que Odds no son probabilidades.**  Para llegar a estimar la probilidades que  un evento ocurra dado un conjunto de variables el modelo de regresión logística considera una serie de supuestos adicionales. 

Las probabiliadades son la tasa (**ratio**) de que algo ocurran respecto a **todo** lo que podria suceder. 
En el caso previo tenemos un total de 5 juegos así que la probabilid de  que mi equipo gane es: $$1/5=.20$$

Nuevamente suponga ahora que nuestro equipo participa en un total de  8 partidos. Gana 5 pierder 3. Igualmente podemos calcular los momios de ganar como $$5/3=1.7$$ Y la probabilidad de ganar como $$5/8=0.625$$

Note que la probabilidad de que mi equipo gane es **diferente** a los **Odds** (Momios) de que mi equipo gane.  


Ahora bien calculemos ahora la probabilidad de que el equipo pierda en el ejemplo anterior.equipo gane entonces  la probabilidad de perder es: $$ 3/8=0.375$$  o bien 1-prob.  de ganar=1-0.625=0.375

Ahora note que podemos calcular los momios (Odds) de ganar  como el ratio de las probabilidades esto es: 

$$\frac{5/8}{1-5/8}=\frac{5/8}{3/8}=5/3=1.7$$

Podemos sintetizar la discusión anterior en la expresión. $$Odds=
\frac{p}{1-p}$$

**Log Odds**= Por qué considerar el logaritmo de los Momios (**log Odds**). 

Considermos nuestro ejemplo inicial. Nuestro equipo juega 5 partidos, gana 1. Entonces tiene Odds de ganar de $$1/4=0.25$$ de forma similar: 

Si juega 9 partidos y gana 1, los Odds de ganar son: $$1/8=0.125$$
Si juega 17 partidos y gana 1, los Odds de ganar son: $$1/16=0.062$$
Si juega 33 partidos y gana 1, los Odds de ganar son: $$1/32=0.031$$

**Note** que si mi equipo es malo, los momios de ganar a medida que le número de partidos aumenta (a medida que el número de partidos tiende a inifnito ($\infty$)),  tienden a cero. de hecho si los Odds estan **encontra** de que mi equipo gane los momios se ubican en el intervalo cerrado [0,1]. Cero si pierde todos los partidos jugados, 1 si gana el mismo número de los que pierde.

Ahora observemos que sucede con los momios  si estos estan a favor de ganar. 

Si juega 9 partidos y gana 6  $$6/3=2$$
Si juega 17 partidos y gana $$14/3=4.6$$
Si juega 33 partidos y gana $$30/3=10$$

Note que los momios a favor de ganar se incrementan a media que el número de juegos aumenta y de hecho  tienden a $\infty$. Pero esta vez se ubican en el intervalo $[1,\infty)$.  Uno si al menos gana los mismos partidos de los que pierde, tiende a $\infty$ si gana todos los juegos jugados $n/0$ (no esta definido paro tiende a **infinito**).

Note que entre los momios a favor de perder  y los de ganar se tiene una asimetría mientras los primeros se ubican en $[0,1]$, los segundos se ubican en el intervalo $[1,\infty)$. Una diferencia abismal en la magnitud !!!

Por ejemplo  Si tenemos 7 juegos. Los momios en contra por ejemplo son $1/6=.16$, pero los momios a favor son: $6/1=6$. Una magnitud completamente desproporcionada!!!

A pesar de que en cada caso sólo se gana o se pierde un sólo juego. 

Este problema de asimetría en los momios se resuelve tomando el logaritmo de los momios.

Ejemplo: $$log(1/6)=-1.791759log(6/1)=1.791759$$ 

Ahora la magnitud en los momios es la misma, es **simetrica**!!

** El log del ratio de probabilidades e.j. log(Odds) Se denomina la función  logit**. $$log(\frac{p}{1-p})$$ 

**Importante** esta expresión tiene como distribución asociada  la clásica standard (NORMAL) y por lo tanto estimar probabilides como áreas debajo de la curva de esta distribución resulta pertinente.

##Función logit. derivación:  


Sea $$p(x)=Pr(Y=1|X)$$ y considerando una representación lineal  $$p(x)=\beta_0 +\beta_1 X$$

Aplicando la definicón del log Odds, tenemos: 

$$\frac{P(X)}{1-P(X)}=e^{ \beta_0 +\beta_1 X}$$
Despejando  p(x), tenemos la **función logit**
$$p(X)=\frac{e^{ \beta_0 +\beta_1 X}}{1 + e^{ \beta_0 +\beta_1 X}}$$


