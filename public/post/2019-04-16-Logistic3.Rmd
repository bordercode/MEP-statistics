---
title: "Logistic3"
author: "JLMR"
date: 2019-04-09T21:14:14-05:00
categories: ["R"]
tags: ["Logistic", "log(odds)", "glm"]
mathjax : true
menu:
  main:
    name: Logistic3 R
    weight: 17
---


```{r set-global-options, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(eval = TRUE, 
                      echo = TRUE, 
                      cache = FALSE,
                      include = TRUE,
                      collapse = FALSE,
                      dependson = NULL,
                      engine = "R", # Chunks will always have R code, unless noted
                      error = FALSE)   


```



```{r silent-packages, echo = FALSE, eval = TRUE, message=FALSE, include = FALSE}
library(tidyverse)
library(ISLR)
library(foreign)
library(scales)
```


Ejecicio estime un modelo de regresión logística considerando el siguiente escenario.

Se tienen una serie de características sociodemograficas (ej. sexo, edad, )incluidos marcadores clínicos para una muestra 297 individuos. 

El objetivo es determinar la probabilidad de que la persona  tenga un padecimiento cardiáco (heart disease). 

La variable dependiente es **hd** con dos categorías: Healthy=0, o Unhealthy=1

A continuación la descrición de la informción disponible y la codificación de las variables.   

age",
  "sex",# 0 = female, 1 = male
  "cp", # chest pain
  # 1 = typical angina,
  # 2 = atypical angina,
  # 3 = non-anginal pain,
  # 4 = asymptomatic
  "trestbps", # resting blood pressure (in mm Hg)
  "chol", # serum cholestoral in mg/dl
  "fbs",  # fasting blood sugar if less than 120 mg/dl, 1 = TRUE, 0 = FALSE
  "restecg", # resting electrocardiographic results
  # 1 = normal
  # 2 = having ST-T wave abnormality
  # 3 = showing probable or definite left ventricular hypertrophy
  "thalach", # maximum heart rate achieved
  "exang",   # exercise induced angina, 1 = yes, 0 = no
  "oldpeak", # ST depression induced by exercise relative to rest
  "slope", # the slope of the peak exercise ST segment
  # 1 = upsloping
  # 2 = flat
  # 3 = downsloping
  "ca", # number of major vessels (0-3) colored by fluoroscopy
  "thal", # this is short of thalium heart scan
  # 3 = normal (no cold spots)
  # 6 = fixed defect (cold spots during rest and exercise)
  # 7 = reversible defect (when cold spots only appear during exercise)
  "hd" # (the predicted attribute) - diagnosis of heart disease
  # 0 if less than or equal to 50% diameter narrowing
  # 1 if greater than 50% diameter narrowing



Estime un modelo de regresión logistica simple para la variable  padecimiento cardiaco (variable hd) considerando como variable independiente  el **sexo** de la persona.

Determine el log del ratio de los momios **log(odds ratio)** indique su magnitud, dirección y sin son estadísticamente significativos al $0.05\%$.  

**Primero una observación básica de los datos **
```{r}
data<-readRDS("heartd.rds")

names(data)
glimpse(data)

xtabs(~ hd + sex, data=data)
```
Note que tenemos aparentemente un mayor problema para el sexo masculino. 

```{r}
logistic <- glm(hd ~ sex, data=data, family="binomial")

summary(logistic)

male.log.odds.ratio <- log((112 / 89) / (25/71))
male.log.odds.ratio
```

##### Predicción de probabilidaes directamente.


```{r}
predic<- data.frame(
  prob.hd=logistic$fitted.values,
  sexo=data$sex)
glimpse(predic)
```
##### Graficamos el resultado.

```{r}
ggplot(predic, aes(sexo, prob.hd, size=prob.hd)) +
  geom_point(aes(colour=sexo)) +
  xlab("Sex") +
  ylab("Prob padecimiento cardiáco")+
  theme_classic()+
  theme(legend.position = "none")

```

#### Estmación RL Multiple  (todas las variables)


```{r}
logistic2 <- glm(hd ~ ., data=data, family="binomial")
summary(logistic2)
```


```{r}
predicted.data <- data.frame(
  probability.of.hd=logistic2$fitted.values,
  hd=data$hd)

predicted.data <- predicted.data[
  order(predicted.data$probability.of.hd, decreasing=FALSE),]
predicted.data$rank <- 1:nrow(predicted.data)


ggplot(data=predicted.data, aes(x=rank, y=probability.of.hd)) +
  geom_point(aes(color=hd), alpha=1, shape=4, stroke=2) +
  xlab("Index") +
  ylab("Predicted probability of getting heart disease")
```




